from flask import Flask, request, jsonify
import numpy as np
from keras.models import load_model


# import os
# os.system('clear')
app = Flask(__name__)

test_arr = [
    1,
    1,
    0,
    0,
    0,
    0,
    0,
    1,
    0,
    0,
    0,
    0,
    1,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
]


@app.route("/process_array", methods=["POST"])
def process_array():
    data = request.get_json()
    input_array = data.get("array")

    model = load_model("model.h5")

    names = [
        "(vertigo) Paroymsal  Positional Vertigo",
        "AIDS",
        "Acne",
        "Alcoholic hepatitis",
        "Allergy",
        "Arthritis",
        "Bronchial Asthma",
        "Cervical spondylosis",
        "Chicken pox",
        "Chronic cholestasis",
        "Common Cold",
        "Dengue",
        "Diabetes ",
        "Dimorphic hemmorhoids(piles)",
        "Drug Reaction",
        "Fungal infection",
        "GERD",
        "Gastroenteritis",
        "Heart attack",
        "Hepatitis B",
        "Hepatitis C",
        "Hepatitis D",
        "Hepatitis E",
        "Hypertension ",
        "Hyperthyroidism",
        "Hypoglycemia",
        "Hypothyroidism",
        "Impetigo",
        "Jaundice",
        "Malaria",
        "Migraine",
        "Osteoarthristis",
        "Paralysis (brain hemorrhage)",
        "Peptic ulcer diseae",
        "Pneumonia",
        "Psoriasis",
        "Tuberculosis",
        "Typhoid",
        "Urinary tract infection",
        "Varicose veins",
        "hepatitis A",
    ]

    input_array = np.array(input_array).reshape(1, 132)
    prediction = model.predict(input_array)
    index = np.argmax(prediction)

    disease_name = names[index]
    probability = np.max(model.predict(input_array))
    probability = round(float(probability) * 100, 1)

    result = {"disease_name": disease_name, "probability": str((probability))}

    return jsonify(result)


@app.route("/get-result/", methods=["GET"])
def get_result():
    model = load_model("model.h5")

    arr = [
        1,
        1,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        1,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
    ]

    names = [
        "(vertigo) Paroymsal  Positional Vertigo",
        "AIDS",
        "Acne",
        "Alcoholic hepatitis",
        "Allergy",
        "Arthritis",
        "Bronchial Asthma",
        "Cervical spondylosis",
        "Chicken pox",
        "Chronic cholestasis",
        "Common Cold",
        "Dengue",
        "Diabetes ",
        "Dimorphic hemmorhoids(piles)",
        "Drug Reaction",
        "Fungal infection",
        "GERD",
        "Gastroenteritis",
        "Heart attack",
        "Hepatitis B",
        "Hepatitis C",
        "Hepatitis D",
        "Hepatitis E",
        "Hypertension ",
        "Hyperthyroidism",
        "Hypoglycemia",
        "Hypothyroidism",
        "Impetigo",
        "Jaundice",
        "Malaria",
        "Migraine",
        "Osteoarthristis",
        "Paralysis (brain hemorrhage)",
        "Peptic ulcer diseae",
        "Pneumonia",
        "Psoriasis",
        "Tuberculosis",
        "Typhoid",
        "Urinary tract infection",
        "Varicose veins",
        "hepatitis A",
    ]

    arr = np.array(arr).reshape(1, 132)
    prediction = model.predict(arr)
    index = np.argmax(prediction)

    disease_name = names[index]
    probability = np.max(model.predict(arr))
    probability = round(probability, 2) * 100
    print(probability)
    result = {"disease_name": disease_name, "probability": str(probability)}

    return jsonify(result), 200


@app.route("/hello/", methods=["GET"])
def welcome():
    return "Hello World!"


if __name__ == "__main__":
    app.run(debug=True)
